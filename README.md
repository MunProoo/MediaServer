# MediaServer

ì‹¤ì‹œê°„ ìŠ¤íŠ¸ë¦¬ë° ë° ë…¹í™”ë¥¼ ì œê³µí•˜ëŠ” ë¯¸ë””ì–´ì„œë²„ì…ë‹ˆë‹¤.

## ğŸ“‹ ëª©ì°¨

- [ì£¼ìš” ê¸°ëŠ¥](#ì£¼ìš”-ê¸°ëŠ¥)
- [ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜](#ì‹œìŠ¤í…œ-ì•„í‚¤í…ì²˜)
- [ì„¤ì¹˜ ë°©ë²•](#ì„¤ì¹˜-ë°©ë²•)
- [ì„¤ì •](#ì„¤ì •)
- [ì‚¬ìš© ë°©ë²•](#ì‚¬ìš©-ë°©ë²•)
- [API ë¬¸ì„œ](#api-ë¬¸ì„œ)
- [ê¸°ìˆ  ìŠ¤íƒ](#ê¸°ìˆ -ìŠ¤íƒ)
- [í”„ë¡œì íŠ¸ êµ¬ì¡°](#í”„ë¡œì íŠ¸-êµ¬ì¡°)
- [ë¼ì´ì„ ìŠ¤](#ë¼ì´ì„ ìŠ¤)

## âœ¨ ì£¼ìš” ê¸°ëŠ¥

### ğŸ¥ ìŠ¤íŠ¸ë¦¬ë°
- **RTSP to WebRTC**: ì‹¤ì‹œê°„ ì €ì§€ì—° ìŠ¤íŠ¸ë¦¬ë° (WebRTC)
- **ë‹¤ì¤‘ ìŠ¤íŠ¸ë¦¼ ê´€ë¦¬**: ì—¬ëŸ¬ RTSP ì†ŒìŠ¤ë¥¼ ë™ì‹œì— ê´€ë¦¬

### ğŸ“¹ ë…¹í™”
- **HLS ê¸°ë°˜ ë…¹í™”**: FFmpegë¥¼ ì‚¬ìš©í•œ HLS ì„¸ê·¸ë¨¼íŠ¸ ë…¹í™”
- **AAC ì˜¤ë””ì˜¤ ì§€ì›**: ë¸Œë¼ìš°ì € í˜¸í™˜ì„±ì„ ìœ„í•œ ì˜¤ë””ì˜¤ íŠ¸ëœìŠ¤ì½”ë”©
- **íƒ€ì„ë¼ì¸ ì¬ìƒ**: ë…¹í™”ëœ ì˜ìƒì˜ íƒ€ì„ë¼ì¸ ê¸°ë°˜ ì¬ìƒ
- **ìë™ ìœ ì§€ë³´ìˆ˜**: ë””ìŠ¤í¬ ê³µê°„ ê´€ë¦¬ ë° ì˜¤ë˜ëœ ë…¹í™” ìë™ ì‚­ì œ

### ğŸ“Š ëª¨ë‹ˆí„°ë§
- **ì‹¤ì‹œê°„ ëŒ€ì‹œë³´ë“œ**: ì‹œìŠ¤í…œ ë° ìŠ¤íŠ¸ë¦¼ ìƒíƒœ ëª¨ë‹ˆí„°ë§
- **WebSocket ê¸°ë°˜ ì—…ë°ì´íŠ¸**: ì‹¤ì‹œê°„ ìƒíƒœ ì—…ë°ì´íŠ¸
- **ìŠ¤íŠ¸ë¦¼ í†µê³„**: í™œì„± ìŠ¤íŠ¸ë¦¼ ìˆ˜, ë…¹í™” ìƒíƒœ ë“±
- **ì‹œìŠ¤í…œ ë©”íŠ¸ë¦­**: CPU, ë©”ëª¨ë¦¬, ë””ìŠ¤í¬, ë„¤íŠ¸ì›Œí¬ ì‚¬ìš©ëŸ‰

### ğŸ›ï¸ ê´€ë¦¬ ê¸°ëŠ¥
- **ìŠ¤íŠ¸ë¦¼ ê´€ë¦¬**: ìŠ¤íŠ¸ë¦¼ ì¶”ê°€, ìˆ˜ì •, ì‚­ì œ
- **ë…¹í™” ì œì–´**: ë…¹í™” ì‹œì‘/ì¤‘ì§€ í† ê¸€
- **ì„¤ì • ê´€ë¦¬**: ì›¹ ê¸°ë°˜ ì„¤ì • ì¸í„°í˜ì´ìŠ¤
- **ë‹¤ì¤‘ ë·°**: ì—¬ëŸ¬ ìŠ¤íŠ¸ë¦¼ ë™ì‹œ ì¬ìƒ

## ğŸ—ï¸ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Client Server â”‚ 
â”‚   - Web UI      â”‚
â”‚   - API Gateway â”‚
â”‚   - Live View   â”‚
â”‚   - Record view â”‚
â”‚   - Monitoring  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â–²â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ Proxy / API
         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  MediaServer    â”‚  
â”‚  - RTSP Server  â”‚
â”‚  - Stream Core  â”‚
â”‚  - Recording    â”‚
â”‚  - Monitoring   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â–²â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ RTSP
         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  RTSP Sources   â”‚
â”‚  (IP Cameras)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

```

### êµ¬ì„± ìš”ì†Œ

1. **Client Server** (`servers/client/`)
   - ì›¹ UI ì œê³µ
   - ìŠ¤íŠ¸ë¦¼ ê´€ë¦¬ API
   - MediaServerë¡œì˜ í”„ë¡ì‹œ
   - WebSocketì„ í†µí•œ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸

2. **MediaServer** (`servers/mediaServer/`)
   - RTSP ì„œë²„ (í¬íŠ¸: 5541)
   - ìŠ¤íŠ¸ë¦¼ ì½”ì–´ ì—”ì§„
   - ë…¹í™” ê´€ë¦¬
   - ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ

3. **TURN Server** (`servers/turnServer/`)
   - WebRTC NAT í†µê³¼ ì§€ì›
   - STUN/TURN ì„œë²„

## ğŸš€ ì„¤ì¹˜ ë°©ë²•

### ì‚¬ì „ ìš”êµ¬ì‚¬í•­

- Go 1.19 ì´ìƒ
- FFmpeg (ë…¹í™” ê¸°ëŠ¥ ì‚¬ìš© ì‹œ)
- Windows ë˜ëŠ” Linux

### ë¹Œë“œ

```bash
# í”„ë¡œì íŠ¸ í´ë¡ 
git clone <repository-url>
cd MediaServer

# ì˜ì¡´ì„± ì„¤ì¹˜
go mod download

# ë¹Œë“œ
go build -o mediaServer.exe ./servers/mediaServer
go build -o client.exe ./servers/client
go build -o turnServer.exe ./servers/turnServer
```

### ì‹¤í–‰

```bash
# MediaServer ì‹¤í–‰
./mediaServer.exe 

# Client Server ì‹¤í–‰ (ë³„ë„ í„°ë¯¸ë„)
./client.exe

# TURN Server ì‹¤í–‰ (ë³„ë„ í„°ë¯¸ë„, ì„ íƒì‚¬í•­)
./turnServer.exe
```

```bash
ì„œë¹„ìŠ¤í™” 
# MediaServer ì„œë¹„ìŠ¤í™”
./mediaServer.exe -rtype install
./mediaServer.exe -rtype start

# turnServer ì„œë¹„ìŠ¤í™”
./turnServer.exe -rtype install
./turnServer.exe -rtype start

# ClientServer ì„œë¹„ìŠ¤í™”
./client.exe -rtype install
./client.exe -rtype start
```

## âš™ï¸ ì„¤ì •

### Client Server ì„¤ì • (`servers/client/config.json`)

```json
{
  "server": {
    "clientPort": 8080,
    "mediaServer": {
      "address": "localhost",
      "port": 8083
    },
    "turnServer": {
      "port": 8888
    }
  },
  "streamList": []
}
```

### MediaServer ì„¤ì • (`servers/mediaServer/msConfig.json`)

ì£¼ìš” ì„¤ì • í•­ëª©:

- `http_port`: HTTP ì„œë²„ í¬íŠ¸ (ê¸°ë³¸: :8083)
- `rtsp_port`: RTSP ì„œë²„ í¬íŠ¸ (ê¸°ë³¸: :5541)
- `ice_servers`: STUN/TURN ì„œë²„ ëª©ë¡
- `ffmpeg_path`: FFmpeg ì‹¤í–‰ íŒŒì¼ ê²½ë¡œ
- `maintenance`: ë…¹í™” ìœ ì§€ë³´ìˆ˜ ì„¤ì •
  - `retention_days`: ë…¹í™” ë³´ê´€ ê¸°ê°„ (ì¼)
  - `retention_capacity`: ìµœëŒ€ ë³´ê´€ ìš©ëŸ‰ (GB)
  - `default_safety_free_space`: ìµœì†Œ ì—¬ìœ  ê³µê°„ (GB)

## ğŸ“– ì‚¬ìš© ë°©ë²•

### 1. ì›¹ ì¸í„°í˜ì´ìŠ¤ ì ‘ì†

ë¸Œë¼ìš°ì €ì—ì„œ `http://localhost:8080` ì ‘ì†

### 2. ìŠ¤íŠ¸ë¦¼ ì¶”ê°€

1. Dashboardì—ì„œ "Add Stream" ë²„íŠ¼ í´ë¦­
2. ìŠ¤íŠ¸ë¦¼ ì •ë³´ ì…ë ¥:
   - Name: ìŠ¤íŠ¸ë¦¼ ì´ë¦„
   - IP: ì¹´ë©”ë¼ IP ì£¼ì†Œ
   - RTSP URL: RTSP ìŠ¤íŠ¸ë¦¼ URL

### 3. ìŠ¤íŠ¸ë¦¼ ì¬ìƒ

- **Live View**: ì‹¤ì‹œê°„ ìŠ¤íŠ¸ë¦¬ë° (WebRTC)
- **Recording**: ë…¹í™”ëœ ì˜ìƒ ì¬ìƒ
- **Multi View**: ì—¬ëŸ¬ ìŠ¤íŠ¸ë¦¼ ë™ì‹œ ì¬ìƒ

### 4. ë…¹í™” ê´€ë¦¬

- ìŠ¤íŠ¸ë¦¼ ì¹´ë“œì—ì„œ "Start Recording" ë²„íŠ¼ í´ë¦­
- Recording íƒ­ì—ì„œ ë…¹í™”ëœ ì˜ìƒ í™•ì¸ ë° ì¬ìƒ
- íƒ€ì„ë¼ì¸ì—ì„œ ì›í•˜ëŠ” ì‹œê°„ëŒ€ë¡œ ì´ë™

### 5. ëª¨ë‹ˆí„°ë§

- Monitoring íƒ­ì—ì„œ ì‹œìŠ¤í…œ ë° ìŠ¤íŠ¸ë¦¼ ìƒíƒœ í™•ì¸
- ì‹¤ì‹œê°„ ë©”íŠ¸ë¦­ ëª¨ë‹ˆí„°ë§
- ìŠ¤íŠ¸ë¦¼ë³„ ìƒíƒœ í™•ì¸

## ğŸ“¡ API ë¬¸ì„œ

### Client Server API

#### ìŠ¤íŠ¸ë¦¼ ê´€ë¦¬

```http
GET    /api/streams              # ìŠ¤íŠ¸ë¦¼ ëª©ë¡ ì¡°íšŒ
GET    /api/streams/:streamID     # íŠ¹ì • ìŠ¤íŠ¸ë¦¼ ì¡°íšŒ
POST   /api/streams               # ìŠ¤íŠ¸ë¦¼ ì¶”ê°€
PUT    /api/streams/:streamID     # ìŠ¤íŠ¸ë¦¼ ìˆ˜ì •
DELETE /api/streams/:streamID     # ìŠ¤íŠ¸ë¦¼ ì‚­ì œ
POST   /api/streams/:streamID/recording  # ë…¹í™” í† ê¸€
```

#### WebSocket

```http
GET /ws/health  # Health ì²´í¬ WebSocket
```

### MediaServer API

ìì„¸í•œ API ë¬¸ì„œëŠ” `servers/mediaServer/docs/api.md` ì°¸ì¡°

ì£¼ìš” ì—”ë“œí¬ì¸íŠ¸:
- `/api/streams` - ìŠ¤íŠ¸ë¦¼ ê´€ë¦¬
- `/api/monitoring/*` - ëª¨ë‹ˆí„°ë§ ë°ì´í„°
- `/api/recording/*` - ë…¹í™” ê´€ë¦¬
- `/webrtc` - WebRTC ìŠ¤íŠ¸ë¦¬ë°
- `/hls` - HLS ìŠ¤íŠ¸ë¦¬ë°
- `/mse` - MSE ìŠ¤íŠ¸ë¦¬ë°

## ğŸ› ï¸ ê¸°ìˆ  ìŠ¤íƒ

### Backend
- **Go**: ë©”ì¸ ì„œë²„ ì–¸ì–´
- **Gin**: HTTP ì›¹ í”„ë ˆì„ì›Œí¬
- **Gorilla WebSocket**: WebSocket ì§€ì›
- **FFmpeg**: ë¹„ë””ì˜¤ ë…¹í™” ë° íŠ¸ëœìŠ¤ì½”ë”©

### Frontend
- **Vanilla JavaScript**: ëª¨ë“ˆí™”ëœ êµ¬ì¡°
  - `websocket.js`: WebSocket ê´€ë¦¬
  - `routing.js`: ë¼ìš°íŒ… ë° íƒ­ ê´€ë¦¬
  - `dashboard.js`: ëŒ€ì‹œë³´ë“œ ì—…ë°ì´íŠ¸
  - `streams.js`: ìŠ¤íŠ¸ë¦¼ ê´€ë¦¬
  - `recording.js`: ë…¹í™” ì¬ìƒ
  - `settings.js`: ì„¤ì • ê´€ë¦¬
- **SweetAlert2**: ì•Œë¦¼ UI
- **HLS.js**: HLS ì¬ìƒ ì§€ì›

### í”„ë¡œí† ì½œ
- **RTSP**: ë¹„ë””ì˜¤ ì†ŒìŠ¤ í”„ë¡œí† ì½œ
- **WebRTC**: ì‹¤ì‹œê°„ ìŠ¤íŠ¸ë¦¬ë°
- **HLS**: HTTP Live Streaming

## ğŸ“ í”„ë¡œì íŠ¸ êµ¬ì¡°

```
MediaServer/
â”œâ”€â”€ servers/
â”‚   â”œâ”€â”€ client/              # Client Server
â”‚   â”‚   â”œâ”€â”€ static/         # ì •ì  íŒŒì¼
â”‚   â”‚   â”‚   â”œâ”€â”€ js/         # JavaScript ëª¨ë“ˆ
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ main.js
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ websocket.js
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ routing.js
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ dashboard.js
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ streams.js
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ recording.js
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ settings.js
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ dataManager.js
â”‚   â”‚   â”‚   â””â”€â”€ css/        # ìŠ¤íƒ€ì¼ì‹œíŠ¸
â”‚   â”‚   â”œâ”€â”€ templates/      # HTML í…œí”Œë¦¿
â”‚   â”‚   â”œâ”€â”€ main.go         # ë©”ì¸ ì„œë²„
â”‚   â”‚   â””â”€â”€ config.json     # ì„¤ì • íŒŒì¼
â”‚   â”‚
â”‚   â”œâ”€â”€ mediaServer/        # MediaServer
â”‚   â”‚   â”œâ”€â”€ media_web/     # ì›¹ ì¸í„°í˜ì´ìŠ¤
â”‚   â”‚   â”œâ”€â”€ docs/          # ë¬¸ì„œ
â”‚   â”‚   â”œâ”€â”€ external_tools/ # FFmpeg ë“±
â”‚   â”‚   â”œâ”€â”€ apiHTTP*.go    # HTTP API í•¸ë“¤ëŸ¬
â”‚   â”‚   â”œâ”€â”€ storage*.go    # ìŠ¤í† ë¦¬ì§€ ê´€ë¦¬
â”‚   â”‚   â”œâ”€â”€ streamCore.go  # ìŠ¤íŠ¸ë¦¼ ì½”ì–´
â”‚   â”‚   â”œâ”€â”€ monitoring.go  # ëª¨ë‹ˆí„°ë§
â”‚   â”‚   â””â”€â”€ msConfig.json  # ì„¤ì • íŒŒì¼
â”‚   â”‚
â”‚   â””â”€â”€ turnServer/         # TURN Server
â”‚
â”œâ”€â”€ define/                 # ê³µí†µ ì •ì˜
â”œâ”€â”€ logUtil/               # ë¡œê¹… ìœ í‹¸ë¦¬í‹°
â”œâ”€â”€ serviceUtil/           # ì„œë¹„ìŠ¤ ê´€ë¦¬
â””â”€â”€ README.md             # ì´ íŒŒì¼
```

## ğŸ”§ ê°œë°œ

### ì½”ë“œ êµ¬ì¡°

í”„ë¡ íŠ¸ì—”ë“œ JavaScriptëŠ” ê¸°ëŠ¥ë³„ë¡œ ëª¨ë“ˆí™”ë˜ì–´ ìˆìŠµë‹ˆë‹¤:

- **websocket.js**: WebSocket ì—°ê²° ë° ì‹¤ì‹œê°„ ë°ì´í„° ìˆ˜ì‹ 
- **routing.js**: íƒ­ ì „í™˜ ë° ë¼ìš°íŒ… ë¡œì§
- **dashboard.js**: ëŒ€ì‹œë³´ë“œ UI ì—…ë°ì´íŠ¸
- **streams.js**: ìŠ¤íŠ¸ë¦¼ CRUD ë° ë…¹í™” ì œì–´
- **recording.js**: ë…¹í™” ì˜ìƒ ì¬ìƒ ë° íƒ€ì„ë¼ì¸ ê´€ë¦¬
- **settings.js**: ì„¤ì • ê´€ë¦¬
- **dataManager.js**: ë°ì´í„° ì‹±ê¸€í†¤ ê´€ë¦¬

### ë¡œê·¸

ë¡œê·¸ëŠ” `logs/YYYYMMDD/` ë””ë ‰í† ë¦¬ì— ì €ì¥ë©ë‹ˆë‹¤.

## ğŸ“ ë¼ì´ì„ ìŠ¤

í”„ë¡œì íŠ¸ ë¼ì´ì„ ìŠ¤ëŠ” ê° ì„œë²„ ë””ë ‰í† ë¦¬ì˜ LICENSE íŒŒì¼ì„ ì°¸ì¡°í•˜ì„¸ìš”.

## ğŸ¤ ê¸°ì—¬

ì´ìŠˆ ë° í’€ ë¦¬í€˜ìŠ¤íŠ¸ë¥¼ í™˜ì˜í•©ë‹ˆë‹¤.

## ğŸ“ ë¬¸ì˜

í”„ë¡œì íŠ¸ ê´€ë ¨ ë¬¸ì˜ì‚¬í•­ì€ ì´ìŠˆë¥¼ í†µí•´ ì œì¶œí•´ì£¼ì„¸ìš”.

---

**MediaServer** - ì†Œê·œëª¨ NVR ì†”ë£¨ì…˜
